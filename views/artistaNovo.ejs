<div class="row-fluid">
    <div class="span12">
        <div class="box paint color_12">
            <div class="title">
                <h4><span>Novo Artista</span></h4>
            </div>

            <div class="content">
                <form id="formNovoArtista" method="post" action="/admin/artista/novo" class="form-horizontal cmxform" autocomplete="off">
                    <div class="form-row control-group row-fluid">
                        <label class="control-label span3" for="nome">
                            Nome *
                            <!--<span class="help-block">*</span>-->
                        </label>
                        <div class="controls span8">
                            <input id="nome" name="nome" type="text" class="span12"/>
                            <label class="error errorRequired" style="display: none;">Por favor, informe o telefone</label>
                            <label class="error errorMinlength" style="display: none;">O nome precisa ter pelo menos 2 caracteres</label>
                        </div>
                    </div>
                    <div class="form-row control-group row-fluid">
                        <label class="control-label span3" for="site">Site</label>
                        <div class="controls span8">
                            <div class="input-prepend row-fluid"> <span class="add-on"><i class="icon-link"></i></span>
                                <input class="row-fluid" type="text" id="site" name="site">
                                <label class="error errorMinlength" style="display: none;">O site precisa ter pelo menos 5 caracteres</label>
                                <label class="error errorUrl" style="display: none;">A URL informada não é válida</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-row control-group row-fluid">
                        <label class="control-label span3" for="email">Email *</label>
                        <div class="controls span8">
                            <input id="email" name="email" type="text" class="span12"/>
                            <label class="error errorRequired" style="display: none;">Por favor, informe o email</label>
                            <label class="error errorMinlength" style="display: none;">O email precisa ter pelo menos 6 caracteres</label>
                            <label class="error errorEmail" style="display: none;">O email informado não é válido</label>
                        </div>
                    </div>
                    <div class="form-row control-group row-fluid">
                        <label class="control-label span3" for="fone">Telefones *</label>
                        <div class="controls span3">
                            <div class="input-prepend row-fluid">
                                <!--<input type="tel" id="tipoFone" name="tipoFone" class="row-fluid" />-->
                                <select id="tipoFone" name="tipoFone" class="row-fluid">
                                    <option value="residencial">Residencial</option>
                                    <option value="oi">Oi</option>
                                    <option value="tim">TIM</option>
                                    <option value="claro">Claro</option>
                                    <option value="vivo">Vivo</option>
                                </select>
                            </div>
                        </div>
                        <div class="controls span4">
                            <div class="input-prepend row-fluid"> <span class="add-on"><i class="icon-phone"></i></span>
                                <input type="tel" id="fone" name="fone" class="row-fluid ignore" placeholder="Número"/>
                                <label class="error errorRequired" style="display: none;">Por favor, informe o telefone</label>
                            </div>
                        </div>
                        <div class="btn-controls btn-group inline span1">
                            <a class="btn adicionarTelefone" href="#">
                                <span class="icon-plus"></span>
                            </a>
                            <!--<a class="btn removerTelefone" href="#">
                                <span class="icon-minus"></span>
                            </a>-->
                        </div>
                    </div>
                    <div class="form-row control-group row-fluid">
                        <label class="control-label span3" for="social">Rede Social</label>
                        <div class="controls span3">
                            <div class="input-prepend row-fluid">
                                <!--<input type="tel" id="tipoSocial" name="tipoSocial" class="row-fluid" />-->
                                <select id="tipoSocial" name="tipoSocial" class="row-fluid">
                                    <option value="facebook">Facebook</option>
                                    <option value="twitter">Twitter</option>
                                    <option value="googleplus">Google+</option>
                                    <option value="myspace">MySpace</option>
                                    <option value="soundcloud">SoundCloud</option>
                                </select>
                            </div>
                        </div>
                        <div class="controls span4">
                            <div class="input-prepend row-fluid"> <span class="add-on"><i class="icon-facebook"></i></span>
                                <input type="text" id="social" name="social" class="row-fluid" placeholder="Link de acesso ao perfil"/>
                                <label class="error errorMinlength" style="display: none;">O link precisa ter pelo menos 5 caracteres</label>
                                <label class="error errorUrl" style="display: none;">O link informado não é válido</label>
                            </div>
                        </div>
                        <div class="btn-controls btn-group inline span1">
                            <a class="btn adicionarSocial" href="#">
                                <span class="icon-plus"></span>
                            </a>
                        </div>
                    </div>
                    <div class="form-actions row-fluid">
                        <div class="span12">
                            <button type="reset" class="btn btn-large btn-secondary pull-right">Cancelar</button>
                            <button type="submit" class="btn btn-large btn-success pull-right">Salvar</button>
                        </div>
                    </div>
                </form>
            </div>

            <a href="#instrucoesModal" class="btn new_item" data-toggle="modal"><i class="icon-info-sign"></i></a>
        </div>
        <!-- End .box --> 
    </div>
</div>

<div id="instrucoesModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="myModalLabel">Instruções</h3>
    </div>
    <div class="modal-body">
        <h4>Para incluir um novo artista, siga as instruções abaixo</h4>

        <p>1. Os campos que contém um <b>*</b> são de preenchimento obrigatório, os demais são opcionais</p>
        <!--<p>2. Acesse o vídeo do YouTube que você deseja incluir</p>
        <p>3. Logo abaixo do título do vídeo, clique em <b>Compartilhar</b></p>
        <p>3. Em seguida, clique em <b>Incorporar</b></p>
        <p>4. Copie o código gerado e cole no campo <b>Código de Compartilhamento</b></p>
        <p>5. Clique em <b>Salvar</b></p>
        <p>6. Pronto! Seu deve ser incluído com sucesso</p>-->
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" data-dismiss="modal">Fechar</button>
    </div>
</div>

<script src="/js/jquery.validate.min.js"></script>

<script>
    $(function () {
        // Validate form

        //$.validator.addMethod(
        //    "regex",
        //    function (value, element, regexp) {
        //        var check = false;
        //        var re = new RegExp(regexp);
        //        return this.optional(element) || re.test(value);
        //    },
        //    "O código de compartilhamento gerado não é válido"
        //);
        //$("form").validate({ debug: true });
        //$("#article_text").rules("add", { regex: "<iframe" })

        //$("#formNovoArtista").validate({
        //    rules: {
        //        nome: {
        //            required: true,
        //            minlength: 2
        //        },
        //        site: {
        //            minlength: 4
        //        },
        //        email: {
        //            required: true,
        //            minlength: 6
        //        }
        //        //fone: {
        //        //    required: true,
        //        //    minlength: 10
        //        //}
        //    },
        //    messages: {
        //        nome: {
        //            required: "Por favor, informe o nome do artista",
        //            minlength: "O título precisa conter pelo menos 2 caracteres"
        //        },
        //        site: {
        //            minlength: "A URL precisa conter pelo menos 4 caracteres",
        //            url: 'O URL informada não é válida'
        //        },
        //        email: {
        //            required: 'Por favor, informe o email',
        //            minlength: "O email precisa conter pelo menos 6 caracteres",
        //            email: 'O email informado não é válido'
        //        }
        //        //fone: {
        //        //    required: 'Por favor, informe o telefone'
        //        //}
        //    },
        //    ignore: '.ignore',
        //    ignoreTitle: true
        //});

        // Erros customizados

        //var gerarErroApenasParaPrimeiroCampoTelefone = function () {
        //    var haErros = false;

        //    var primeiroTelefone = $('[name=fone]').first();

        //    if (primeiroTelefone.val() === '') {
        //        haErros = true;
        //        primeiroTelefone.addClass('error');
        //        primeiroTelefone.siblings().filter('.errorRequired').show();
        //    } else {
        //        primeiroTelefone.removeClass('error');
        //        primeiroTelefone.siblings().filter('.errorRequired').hide();
        //    }

        //    return haErros;
        //};

        var gerarErroRequired = function (e) {
            var haErros = false;
            var campo = $(e.currentTarget);

            if (campo.val() === '') {
                haErros = true;
                campo.addClass('error');
                campo.siblings('.error').hide();
                campo.siblings().filter('.errorRequired').show();
            } else {
                campo.removeClass('error');
                campo.siblings().filter('.errorRequired').hide();
            }

            return haErros;
        };

        var gerarErroMinlength = function (e, minlength) {
            var haErros = false;
            var campo = $(e.currentTarget);

            if (campo.val() !== '' && campo.val().length < minlength) {
                haErros = true;
                campo.addClass('error');
                campo.siblings('.error').hide();
                campo.siblings().filter('.errorMinlength').show();
            } else {
                campo.removeClass('error');
                campo.siblings().filter('.errorMinlength').hide();
            }

            return haErros;
        };

        var gerarErroUrl = function (e, minlength) {
            var haErros = false;
            var campo = $(e.currentTarget);

            var regexp = /((ftp|https?):\/\/)?(www\.)?[a-z0-9\-\.]{3,}\.[a-z]{3}(\.[a-z]{2})?$/;

            if (campo.val() !== '' && !regexp.test(campo.val())) {
                haErros = true;
                campo.addClass('error');
                campo.siblings('.error').hide();
                campo.siblings().filter('.errorUrl').show();
            } else {
                campo.removeClass('error');
                campo.siblings().filter('.errorUrl').hide();
            }

            return haErros;
        };

        var gerarErroEmail = function (e, minlength) {
            var haErros = false;
            var campo = $(e.currentTarget);

            var regexp = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;

            if (campo.val() !== '' && !regexp.test(campo.val())) {
                haErros = true;
                campo.addClass('error');
                campo.siblings('.error').hide();
                campo.siblings().filter('.errorEmail').show();
            } else {
                campo.removeClass('error');
                campo.siblings().filter('.errorEmail').hide();
            }

            return haErros;
        };

        // campos

        var campoNome = $('[name=nome]');
        var campoSite = $('[name=site]');
        var campoEmail = $('[name=email]');
        var campoPrimeiroTelefone = $('[name=fone]').first();
        var campoPrimeiraRedeSocial = $('[name=social]');

        // eventos

        var verificarErrosDoCampoTelefone = function (e) { gerarErroRequired(e); };
        var verificarErrosDoCampoNome = function (e) {
            var haErro = false;
            haErro = gerarErroRequired(e);

            if (!haErro) {
                haErro = gerarErroMinlength(e, 2);
            }

            return haErro;
        };
        var verificarErrosDoCampoSite = function (e) {
            var haErro = false;
            haErro = gerarErroMinlength(e, 5);

            if (!haErro) {
                haErro = gerarErroUrl(e);
            }

            return haErro;
        };
        var verificarErrosDoCampoEmail = function (e) {
            var haErro = false;
            haErro = gerarErroRequired(e);

            if (!haErro) {
                haErro = gerarErroMinlength(e, 6);
            }

            if (!haErro) {
                haErro = gerarErroEmail(e);
            }

            return haErro;
        };
        
        var verificarErrosDoCampoRedeSocial = function (e) {
            var haErro = false;
            haErro = gerarErroMinlength(e, 5);

            if (!haErro) {
                haErro = gerarErroUrl(e);
            }

            return haErro;
        };

        campoNome.on('keyup', verificarErrosDoCampoNome);
        campoSite.on('keyup', verificarErrosDoCampoSite);
        campoEmail.on('keyup', verificarErrosDoCampoEmail);
        campoPrimeiroTelefone.on('keyup', verificarErrosDoCampoTelefone);
        campoPrimeiraRedeSocial.on('keyup', verificarErrosDoCampoRedeSocial);

        // disparar verificação de validação de campos no submit do form

        $("#formNovoArtista").on('submit', function (e) {
            var haErros = false;

            haErros = verificarErrosDoCampoNome({ currentTarget: campoNome });
            if (haErros) { verificarErrosDoCampoSite({ currentTarget: campoSite }) } else { haErros = verificarErrosDoCampoSite({ currentTarget: campoSite }); }
            if (haErros) { verificarErrosDoCampoEmail({ currentTarget: campoEmail }) } else { haErros = verificarErrosDoCampoEmail({ currentTarget: campoEmail }); }
            if (haErros) { verificarErrosDoCampoTelefone({ currentTarget: campoPrimeiroTelefone }) } else { haErros = verificarErrosDoCampoTelefone({ currentTarget: campoPrimeiroTelefone }); }
            if (haErros) { verificarErrosDoCampoRedeSocial({ currentTarget: campoPrimeiraRedeSocial }) } else { haErros = verificarErrosDoCampoRedeSocial({ currentTarget: campoPrimeiraRedeSocial }); }

            var haAlgumaMensagemDeErroSendoExposta = $(e.currentTarget).find('.error:visible').length;

            if (!haErros && haAlgumaMensagemDeErroSendoExposta) {
                haErros = true;
            }

            if (haErros) {
                e.preventDefault();
            }
        });

        // Comportamento dos botões para dicionar controles

        $(document).on('click', '.adicionarTelefone', function (e) {
            var _this = $(e.currentTarget);
            var controle = _this.parent().parent();
            var clone = controle.clone();
            clone.addClass('offset3');
            clone.find('label').remove();
            clone.find('.error').remove();
            clone.find('select option:selected').removeAttr('selected');
            var input = clone.find('input');
            input.val('');

            var controleDeRemocaoExiste = clone.find('.btn-controls').find('.removerTelefone').length;

            if (!controleDeRemocaoExiste) {
                var controleDeRemocao = $('<a class="btn removerTelefone" href="#"><span class="icon-minus"></span></a>');
                clone.find('.btn-controls').append(controleDeRemocao);
            }

            clone.insertAfter(controle);
            input.focus();
        });

        $(document).on('click', '.removerTelefone', function (e) {
            var _this = $(e.currentTarget);
            _this.parent().parent().remove();
        });

        $(document).on('click', '.adicionarSocial', function (e) {
            var _this = $(e.currentTarget);
            var controle = _this.parent().parent();
            var clone = controle.clone();
            clone.addClass('offset3');
            clone.find('label').remove();
            clone.find('.error').remove();
            clone.find('select option:selected').removeAttr('selected');
            var input = clone.find('input');
            input.val('');

            var controleDeRemocaoExiste = clone.find('.btn-controls').find('.removerSocial').length;

            if (!controleDeRemocaoExiste) {
                var controleDeRemocao = $('<a class="btn removerSocial" href="#"><span class="icon-minus"></span></a>');
                clone.find('.btn-controls').append(controleDeRemocao);
            }

            clone.insertAfter(controle);
            input.focus();
        });

        $(document).on('click', '.removerSocial', function (e) {
            var _this = $(e.currentTarget);
            _this.parent().parent().remove();
        });
    });
</script>